from io import BytesIO
from flask import Flask, make_response, request, jsonify
import numpy as np
import pandas as pd
import os
from PIL import Image
from create_csv.process_images import process_image
from create_model import create_model
from flask_cors import CORS
import base64

app = Flask(__name__)
CORS(app)

model = create_model('data.csv')

def get_predicted_value(model, data):
    return model.predict(data)

characters = {
    1.0: "අ",
    21.0: "ක",
    54.0: "ව",
    12.0: "ර"
}

@app.route("/")
def home():
    return make_response({
        "home": "Home"
    })

@app.route("/get_ocr", methods=['GET'])
def get_ocr():

    try:
        if(request.method=='GET'):
        #if 'image' not in request.files:
        #    print("not image")
        #    return 'not image in form'
        #image = request.files['image']
            image = request.args.get("image")
            #print(image)
            #image_decode = base64.b64decode(image)
            #image_result = open('image.png', 'wb')
            #image_result.write(image_decode)
            #print(image_decode)
            
            #print(image)

            ii = image.replace("data:image/png;base64,","")
            ii = ii.replace(" ", "+")
            print(ii)

            img = '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'
            #print(img)

            #with open("image.png", "wb") as fh:
            #    fh.write(base64.b64decode(image))

            im = Image.open(BytesIO(base64.b64decode(ii)))
            im.save('save/image.png', 'PNG')
            #upload_image(image)
            #img = Image.open(image.filename)
            #img.show()
            arr = process_image('save/image.png')
            arr = arr.reshape(1,-1)
            print(arr)
            y_predict = get_predicted_value(model, arr)
            print(y_predict)
            print(characters[y_predict[0]])

            return jsonify(predicted_resilt=characters[y_predict[0]])

    except Exception as e:
        print(e)
        return make_response({
            "error": e
        }) 


def upload_image(image):
    path = os.path.join('save/image.png')
    image.save(path)

if __name__ == "__main__":
    app.debug(True)
    app.run(host='0.0.0.0')